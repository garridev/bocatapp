{% extends 'base.html' %}
{% load staticfiles %}
{% block title %}{{local.name}} - Carta {%endblock%}

{% block content %}
      <div class="container">
        <h2>{{local.name}}</h2>
         <div class="table-responsive">
            <table id="menu" class="table table-striped table-hover table-menu">
                <thead>
                    <tr>
                        <th class="no-sort">Nombre</th>
                        <th class="no-sort">Ingredientes</th>
                        <th>Precio</th>
                        {% if perms.bocatapp.customer or user.is_anonymous %}
                        <th class="no-sort"></th>
                        {% endif %}
{#                        <th class="no-sort">Ingredientes</th>#}

                    </tr>
                </thead>
                <tbody>
                    {% for p in productos %}
                    <tr>
                        <td> {{p.name}} </td>
                        <td> {{p.ingredients}}
                        <td> {{p.price}} â‚¬</td>
                        {% if perms.bocatapp.customer or user.is_anonymous %}
                        <td>
                            <input type="hidden" value="{{p.id}}" id="productId" />
                            <input type="number" value="1" id="quantity" min="1" max="10"/>
                            <a href="#" class="btn btn-success" id="addsc">
                                <span class="glyphicon glyphicon-shopping-cart"></span>
                            </a>
                        </td>
                        {% endif %}

                    </tr>
                    {% endfor %}
                </tbody>
            </table>
           </div>
        </div>
{%endblock%}

{% block scripts %}
    {{block.super}}
    <script type="text/javascript">
        $('#menu tbody').on( 'click', '#addsc', function () {
            var td = $(this).parents('tr').children('td');
            var quantity = td.children('input#quantity').val();
            var id = td.children('input#productId').val();
            var cartId = getIdCart();

            $.ajax({
                url: '{% url "add_product_cart" %}',
                data: {
                    'idCart': cartId, 
                    'idProduct': id,
                    'quantity': quantity
                },
                dataType: 'json',
                success: function (data) {
                    UpdateBadge();
                }
            });
        } );
    </script>
{% endblock %}